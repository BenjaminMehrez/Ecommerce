{% extends 'layouts/blank.html' %}
{% load price_filters %}
{% load static %}


{% block content %}

<div class="flex min-h-screen bg-gray-50">
    <!-- Sidebar -->
    <div class="hidden md:block w-64 bg-white shadow-sm">
        <div class="px-4 py-6">
            <div class="flex items-center gap-4 ">
                <img src="{% static 'images/logo-black.svg' %}" alt="E-commerce" class="h-8">
                <h2 class="flex mt-2">E-commerce</h2>
            </div>
            <nav class="mt-6 space-y-2">
                <a href="" class="flex items-center px-4 py-2 text-gray-900 bg-gray-100 font-medium rounded-lg">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    Panel
                </a>
                <a href="{% url 'products' %}" class="flex items-center px-4 py-2 text-gray-700 rounded-lg">
                    <img class="w-5 h-5 mr-3" src="{% static 'images/logo-black.svg' %}" alt="">
                    Productos
                </a>
                <a href="{% url 'orders' %}" class="flex items-center px-4 py-2 text-gray-700 rounded-lg">
                    <svg class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" xmlns="https://www.w3.org/2000/svg">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path d="M3.17004 7.43994L12 12.5499L20.77 7.46991" stroke="#292D32" stroke-width="1.5"
                                stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M12 21.6099V12.5399" stroke="#292D32" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round"></path>
                            <path
                                d="M9.92999 2.48L4.59 5.45003C3.38 6.12003 2.39001 7.80001 2.39001 9.18001V14.83C2.39001 16.21 3.38 17.89 4.59 18.56L9.92999 21.53C11.07 22.16 12.94 22.16 14.08 21.53L19.42 18.56C20.63 17.89 21.62 16.21 21.62 14.83V9.18001C21.62 7.80001 20.63 6.12003 19.42 5.45003L14.08 2.48C12.93 1.84 11.07 1.84 9.92999 2.48Z"
                                stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M17 13.24V9.58002L7.51001 4.09998" stroke="#292D32" stroke-width="1.5"
                                stroke-linecap="round" stroke-linejoin="round"></path>
                        </g>
                    </svg>
                    Ordenes
                </a>
                <a href="{% url 'reviews' %}" class="flex items-center px-4 py-2 text-gray-700 rounded-lg">
                    <svg class="w-5 h-5 mr-3" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>start-favorite</title> <desc>Created with Sketch Beta.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"> <g id="Icon-Set" sketch:type="MSLayerGroup" transform="translate(-152.000000, -879.000000)" fill="#000000"> <path d="M168,903.21 L160.571,907.375 L161.989,898.971 L155.594,892.442 L164.245,891.317 L168,883.313 L171.722,891.317 L180.344,892.54 L174.011,899.002 L175.335,907.406 L168,903.21 L168,903.21 Z M184,891.244 L172.962,889.56 L168,879 L163.038,889.56 L152,891.244 L159.985,899.42 L158.095,911 L168,905.53 L177.905,911 L176.015,899.42 L184,891.244 L184,891.244 Z" id="start-favorite" sketch:type="MSShapeGroup"> </path> </g> </g> </g></svg>
                    Calificaciones
                </a>
            </nav>
        </div>
    </div>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8">
            <div>
                <h1 class="text-xl lg:text-2xl font-semibold text-gray-900">Panel</h1>
                <p class="text-sm text-gray-500">Todos los datos sobre tu negocio aquí</p>
            </div>
        </div>

        <!-- Metrics Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Revenue Card -->
            <div class="bg-white p-4 lg:p-6 rounded-lg shadow-sm flex items-center">
                <div class="p-2 bg-green-50 rounded-full">
                    <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Ganancia</p>
                    <p class="text-lg font-semibold text-gray-900">
                        {% if revenue.price == 0 %}
                            $ 0
                        {% else %}
                            $ {{ revenue.price|formato_precio }}
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- Orders Card -->
            <div class="bg-white p-4 lg:p-6 rounded-lg shadow-sm flex items-center">
                <div class="p-2 bg-blue-50 rounded-full">
                    <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Ordenes</p>
                    <p class="text-lg font-semibold text-gray-900">{{ total_orders_count.count }}</p>
                </div>
            </div>

            <!-- Products Card -->
            <div class="bg-white p-4 lg:p-6 rounded-lg shadow-sm flex items-center">
                <div class="p-2 bg-orange-50 rounded-full">
                    <svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Productos</p>
                    <p class="text-lg font-semibold text-gray-900">{{ all_products.count }}</p>
                </div>
            </div>

            <!-- Monthly Earning Card -->
            <div class="bg-white p-4 lg:p-6 rounded-lg shadow-sm flex items-center">
                <div class="p-2 bg-purple-50 rounded-full">
                    <svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Ganancias mensuales</p>
                    <p class="text-lg font-semibold text-gray-900">
                        {% if monthly_revenue.price == 0 %}
                            $ 0
                        {% else %}
                            $ {{ monthly_revenue.price|formato_precio }}
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="hidden lg:block bg-white rounded-lg shadow-sm">
            <div class="p-4 lg:p-6">
                <h2 class="text-lg font-semibold text-gray-900">Ordenes Recientes</h2>
                <div class="mt-4 overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Orden ID</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nombre</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Apellido</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Correo</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Celular</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado de Pago</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ver Detalles</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for order in latest_orders %}
                            <tr>
                                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{{ order.sku }}</td>
                                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{{ order.first_name }}</td>
                                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{{ order.last_name }}</td>
                                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{{ order.email }}</td>
                                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{{ order.phone }}</td>
                                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">{{ order.order_date }}</td>
                                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">$ {{ order.price|formato_precio }}</td>
                                <td class="px-4 py-2 whitespace-nowrap">
                                    {% if order.paid_status %}
                                    <span class="px-2 inline-flex text-xs font-semibold rounded-full bg-green-100 text-green-800">Pagado</span>
                                    {% else %}
                                    <span class="px-2 inline-flex text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Sin Pagar</span>
                                    {% endif %}
                                </td>
                                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">
                                    <a href="{% url 'order-detail-admin' order.id %}" class="text-green-600 hover:text-green-900">Ver detalles</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="lg:hidden flex-1 min-h-screen">
            <div class="pb-32">
                <header class="py-10">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h2 class="text-3xl font-extrabold">
                            Ordenes Recientes
                        </h2>
                    </div>
                </header>
            </div>
        
            <main class="-mt-32">
                <div class="max-w-7xl mx-auto pb-12 px-4 sm:px-6 lg:px-8">
                    <div class="bg-white rounded-lg">
                    <div class="flex flex-col gap-10">
                            {% for order in latest_orders %}
                            <div class="p-6 hover:bg-gray-50 transition duration-150 ease-in-out bg-white rounded-lg shadow-md overflow-hidden">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-lg font-semibold text-gray-900">
                                        Orden #{{ order.sku }}
                                    </h3>
                                </div>
                                <div class="mt-2 sm:flex sm:justify-between">
                                    <div class="sm:flex">
                                        <p class="flex items-center text-sm text-gray-500">
                                            <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" xmlns="https://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                            </svg>
                                            {{ order.order_date|date:"d M Y, H:i" }}
                                        </p>
                                        <p class="mt-2 flex items-center text-sm text-gray-500 sm:mt-0 sm:ml-6">
                                            <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" xmlns="https://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                            </svg>
                                            $ {{ order.price|formato_precio }}
                                        </p>
                                    </div>
                                </div>
                                <div class="flex flex-col">
                                    <p class="flex items-center text-sm text-gray-500">Nombre: {{ order.first_name }} {{ order.last_name }}</p>
                                    <p class="flex items-center text-sm text-gray-500">Correo: {{ order.email }}</p>
                                    <p class="flex items-center text-sm text-gray-500">Celular: {{ order.phone }}</p>
                                </div>
                                <div class="mt-4 border-t border-gray-200 pt-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <svg class="h-5 w-5 text-{% if order.paid_status %}green-500{% else %}red-500{% endif %}" xmlns="https://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                {% if order.paid_status %}
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                                {% else %}
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                                {% endif %}
                                            </svg>
                                            <span class="ml-2 text-sm font-medium text-gray-700">
                                                {{ order.paid_status|yesno:"Pagado,Pendiente de pago" }}
                                            </span>
                                        </div>
                                        <a href="{% url 'order-detail-admin' order.id %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            Ver detalles
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="p-6">
                                <p class="text-center text-gray-500">No hay órdenes disponibles.</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

</div>


<div id="spinner" class="absolute top-2/4 left-2/4" hx-trigger="load">
    <svg class="htmx-indicator loader" width="35" height="35" viewBox="0 0 24 24" xmlns="https://www.w3.org/2000/svg"><path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"/><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z"><animateTransform attributeName="transform" type="rotate" dur="0.75s" values="0 12 12;360 12 12" repeatCount="indefinite"/></path></svg>
</div>
{% endblock %}